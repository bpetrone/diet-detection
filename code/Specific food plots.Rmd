---
title: "Specific food plots"
output: html_notebook
---

# R setup

```{r setup, include=FALSE, echo=FALSE}
require("knitr")
opts_knit$set(root.dir = file.path(getwd(), '..'))
```

```{r libraries, echo=FALSE}
library(here) 
library(MButils)
library(phyloseq) 
library(RColorBrewer)
library(tidyverse) 
```

# Read in data

## Taxon name mapping

```{r}
name.sync <- 
     here('data',
          'processed',
          'Naming discrepancies.xlsx') %>% 
     readxl::read_excel()

name.sync
```

## Metaproteomic phyloseq

```{r}
ps.protein <- 
     here('data', 
          'processed', 
          'phyloseq',
          'combined',
          'filtered',
          'ps_mp_1PUP_taxa.rds') %>% # >=1 protein unique peptide
          # 'ps_mp_1UP_taxa.rds') %>% # >=1 unique peptide
     readRDS()
          
ps.protein
```

## Menu data phyloseq

```{r}
ps.menu <- 
     here('data', 
          'processed', 
          'phyloseq',
          'combined',
          'filtered',
          'ps_menu.rds') %>% 
     readRDS()

ps.menu
```

## Metabarcoding phyloseq

```{r}
ps.mb.plant <- 
     here('data', 
          'processed', 
          'phyloseq',
          'combined',
          'filtered',
          'ps_mb_trnL.rds') %>% 
     readRDS()

ps.mb.plant
```

```{r}
ps.mb.animal <- 
     here('data', 
          'processed', 
          'phyloseq',
          'combined',
          'filtered',
          'ps_mb_12SV5.rds') %>% 
     readRDS()

ps.mb.plant
```

# Reformat for plotting

```{r}
melt.menu <- 
     psmelt(ps.menu) %>% 
     rename(subj = ID)
melt.mb <- psmelt(ps.mb)
melt.mp <- psmelt(ps.protein)
```

```{r}
taxon.mb <- 'Acer'
taxon.mp <- 'Acer saccharum'
taxon.menu <- 'Acer'
```

```{r}
vs <- c('subj', 'date', 'OTU', 'Abundance') # Shared variables to pull from each phyloseq

filter_melt <- function(melt, taxon, type){
     # melt: melt object
     # taxon: one of taxon.mp, taxon.mb, or taxon.menu, above
     # type: the data type of the object (menu, metabarcoding, metaproteomics)
     melt %>% 
          select(one_of(vs)) %>% 
          filter(OTU == taxon & Abundance > 0) %>% 
          mutate(method = type) 
          
}
```

```{r}
filter_melt(melt.menu, 'Serranidae', 'Menu')
```
```{r}
filter_melt(melt.mp, 'Acer saccharum', 'Metaproteomics')
```


```{r}
df %>% 
     filter(taxon_mb == taxon.mb)
ggplot(aex(x = date, y = Abundance)) +
     facet_wrap(~method)
```

